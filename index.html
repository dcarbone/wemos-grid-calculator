<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>8x8 grid</title>
    <style rel="tex/css">
        td.pixel, td.hexadecimal {
            height: 32px;
            width: 32px;
        }
        td.binary {
            font-family: monospace;
            text-align: center;
            width: 75px;
        }
        td.pixel {
            border-right: 1px solid;
            border-top: 1px solid;
            border-color: #ddd;
        }
        td.hexadecimal {
            font-family: monospace;
            border: none;
        }
        tr th:first-child {
            width: 36px;
        }
        tr.y td:nth-child(2) {
            border-left: 1px solid #ddd;
        }
        tr.y td.pixel:hover {
            cursor: pointer;
        }
        tr.y:nth-child(8) td.pixel {
            border-bottom: 1px solid #ddd;
        }
        #hexadecimals {
            text-align: center;
        }
        span.dot {
            display: block;
            width: 28px;
            height: 28px;
            border-radius: 28px;
            margin-left: 2px;
            background: #ff0000;
        }
    </style>
</head>
<body>
<table id="grid" cellspacing="0" cellpadding="0">
    <tbody>
    <tr data-y="7" class="y">
        <th>7</th>
        <td data-x="0" class="pixel"></td>
        <td data-x="1" class="pixel"></td>
        <td data-x="2" class="pixel"></td>
        <td data-x="3" class="pixel"></td>
        <td data-x="4" class="pixel"></td>
        <td data-x="5" class="pixel"></td>
        <td data-x="6" class="pixel"></td>
        <td data-x="7" class="pixel"></td>
        <td class="binary">0</td>
    </tr>
    <tr data-y="6" class="y">
        <th>6</th>
        <td data-x="0" class="pixel"></td>
        <td data-x="1" class="pixel"></td>
        <td data-x="2" class="pixel"></td>
        <td data-x="3" class="pixel"></td>
        <td data-x="4" class="pixel"></td>
        <td data-x="5" class="pixel"></td>
        <td data-x="6" class="pixel"></td>
        <td data-x="7" class="pixel"></td>
        <td class="binary">0</td>
    </tr>
    <tr data-y="5" class="y">
        <th>5</th>
        <td data-x="0" class="pixel"></td>
        <td data-x="1" class="pixel"></td>
        <td data-x="2" class="pixel"></td>
        <td data-x="3" class="pixel"></td>
        <td data-x="4" class="pixel"></td>
        <td data-x="5" class="pixel"></td>
        <td data-x="6" class="pixel"></td>
        <td data-x="7" class="pixel"></td>
        <td class="binary">0</td>
    </tr>
    <tr data-y="4" class="y">
        <th>4</th>
        <td data-x="0" class="pixel"></td>
        <td data-x="1" class="pixel"></td>
        <td data-x="2" class="pixel"></td>
        <td data-x="3" class="pixel"></td>
        <td data-x="4" class="pixel"></td>
        <td data-x="5" class="pixel"></td>
        <td data-x="6" class="pixel"></td>
        <td data-x="7" class="pixel"></td>
        <td class="binary">0</td>
    </tr>
    <tr data-y="3" class="y">
        <th>3</th>
        <td data-x="0" class="pixel"></td>
        <td data-x="1" class="pixel"></td>
        <td data-x="2" class="pixel"></td>
        <td data-x="3" class="pixel"></td>
        <td data-x="4" class="pixel"></td>
        <td data-x="5" class="pixel"></td>
        <td data-x="6" class="pixel"></td>
        <td data-x="7" class="pixel"></td>
        <td class="binary">0</td>
    </tr>
    <tr data-y="2" class="y">
        <th>2</th>
        <td data-x="0" class="pixel"></td>
        <td data-x="1" class="pixel"></td>
        <td data-x="2" class="pixel"></td>
        <td data-x="3" class="pixel"></td>
        <td data-x="4" class="pixel"></td>
        <td data-x="5" class="pixel"></td>
        <td data-x="6" class="pixel"></td>
        <td data-x="7" class="pixel"></td>
        <td class="binary">0</td>
    </tr>
    <tr data-y="1" class="y">
        <th>1</th>
        <td data-x="0" class="pixel"></td>
        <td data-x="1" class="pixel"></td>
        <td data-x="2" class="pixel"></td>
        <td data-x="3" class="pixel"></td>
        <td data-x="4" class="pixel"></td>
        <td data-x="5" class="pixel"></td>
        <td data-x="6" class="pixel"></td>
        <td data-x="7" class="pixel"></td>
        <td class="binary">0</td>
    </tr>
    <tr data-y="0" class="y">
        <th>0</th>
        <td data-x="0" class="pixel"></td>
        <td data-x="1" class="pixel"></td>
        <td data-x="2" class="pixel"></td>
        <td data-x="3" class="pixel"></td>
        <td data-x="4" class="pixel"></td>
        <td data-x="5" class="pixel"></td>
        <td data-x="6" class="pixel"></td>
        <td data-x="7" class="pixel"></td>
        <td class="binary">0</td>
    </tr>
    <tr id="hexadecimals">
        <th>hex</th>
        <td class="hexadecimal">0x0</td>
        <td class="hexadecimal">0x0</td>
        <td class="hexadecimal">0x0</td>
        <td class="hexadecimal">0x0</td>
        <td class="hexadecimal">0x0</td>
        <td class="hexadecimal">0x0</td>
        <td class="hexadecimal">0x0</td>
        <td class="hexadecimal">0x0</td>
    </tr>
    </tbody>
    <thead>
    <tr>
        <th>&nbsp;</th>
        <th>0</th>
        <th>1</th>
        <th>2</th>
        <th>3</th>
        <th>4</th>
        <th>5</th>
        <th>6</th>
        <th>7</th>
        <th>binary</th>
    </tr>
    </thead>
</table>
<div>
    <button id="cleargrid">Clear</button>
    <button id="fillgrid">Fill</button>
    <button id="invertgrid">Invert</button>
</div>
<script type="text/javascript">
    "use strict";

    // TODO: more efficient initialization.

    let disBuffer = [0, 0, 0, 0, 0, 0, 0, 0];

    const gridTable = document.getElementById('grid');
    let gridBody, gridHead;
    for (let i = 0; i < gridTable.children.length; i++) {
        const node = gridTable.children[i];
        const name = node.nodeName.toLowerCase();
        if ('tbody' === name) {
            gridBody = node;
        } else if ('thead' === name) {
            gridHead = node;
        }
    }
    if (undefined === gridBody || null === gridBody) {
        alert('Unable to locate grid table body, nothing will work.');
    }
    const pixelNodes = function () {
        let nodes = [];
        let tr, td;
        let ti, tri;
        for (ti = 0; ti < gridBody.children.length; ti++) {
            tr = gridBody.children[ti];
            for (tri = 0; tri < tr.children.length; tri++) {
                if ('td' === tr.children[tri].nodeName.toLowerCase()) {
                    td = tr.children[tri];
                    if (td.hasAttribute('class') && td.getAttribute('class').match('pixel')) {
                        nodes.push(td);
                    }
                }
            }
        }
        return nodes;
    }();
    const hexNodes = function () {
        const tr = document.getElementById('hexadecimals');
        let x = 0;
        let nodes = [];
        for (let i = 0; i < tr.children.length; i++) {
            if ('td' === tr.children[i].nodeName.toLowerCase() && tr.children[i].hasAttribute('class') && tr.children[i].getAttribute('class').match('hexadecimal')) {
                nodes[x++] = tr.children[i];
            }
        }
        return nodes;
    }();
    const binaryNodes = function () {
        let y = 7;
        let nodes = [];
        for (let i = 0; i < gridBody.children.length; i++) {
            if ('tr' === gridBody.children[i].nodeName.toLowerCase()) {
                let tr = gridBody.children[i];
                for (let ri = 0; ri < tr.children.length; ri++) {
                    if ('td' === tr.children[ri].nodeName.toLowerCase() && tr.children[ri].hasAttribute('class') && tr.children[ri].getAttribute('class').match('binary')) {
                        nodes[y--] = tr.children[ri];
                    }
                }
            }
        }
        return nodes;
    }();

    function newDot() {
        const dot = document.createElement('span');
        dot.setAttribute('class', 'dot');
        return dot;
    }

    function togglePixel(el) {
        let parent, row, pixel, dot, x, y;
        switch (el.nodeName.toLowerCase()) {
            case 'span':
                dot = el;
                parent = el.parentNode;
                while (parent !== null) {
                    if (parent.nodeName.toLowerCase() === 'td' && parent.hasAttribute('data-x')) {
                        pixel = parent;
                        break;
                    }
                }
                break;
            case 'td':
                pixel = el;
                for (let i = 0; i < el.children.length; i++) {
                    if (el.children[i].hasAttribute('class') && el.children[i].getAttribute('class').match('dot')) {
                        dot = el.children[i];
                        break;
                    }
                }
                break;
        }
        if (undefined === pixel || null === pixel) {
            alert('Unable to locate pixel!');
            return;
        }
        if (!pixel.hasAttribute('data-x')) {
            alert('Unable to locate "data-x" attribute on <td>!');
            return;
        } else {
            x = parseInt(pixel.getAttribute('data-x'), 10);
        }

        parent = pixel.parentNode;
        while (null !== parent) {
            if ('tr' === parent.nodeName.toLowerCase() && parent.hasAttribute('data-y')) {
                row = parent;
                break;
            }
        }
        if (undefined === row || null === row) {
            alert('Unable to locate row!');
            return;
        } else {
            y = parseInt(row.getAttribute('data-y'), 10);
        }

        if ('undefined' === typeof hexNodes[y]) {
            alert('Unable to locate valuenode for ' + y);
            return;
        }

        if (undefined === dot || null === dot) {
            pixel.appendChild(newDot());
            disBuffer[y] |= (1 << x);
        } else {
            pixel.removeChild(dot);
            disBuffer[y] &= ~(1 << x);
        }

        // TODO: Maybe don't assume first child...?
        for (let i = 0; i < 8; i++) {
            if (0 === disBuffer[i]) {
                binaryNodes[i].firstChild.nodeValue = '0';
                hexNodes[i].firstChild.nodeValue = '0x0';
            } else {
                binaryNodes[i].firstChild.nodeValue = disBuffer[i].toString(2);
                hexNodes[i].firstChild.nodeValue = '0x' + disBuffer[i].toString(16);
            }
        }
    }

    document.getElementById('grid').addEventListener('mousedown', function (e) {
        if (1 !== e.which || !e.target.hasAttribute('class') || (!e.target.getAttribute('class').match('pixel') && !e.target.getAttribute('class').match('dot'))) {
            return;
        }
        togglePixel(e.target);
    });
    document.getElementById('cleargrid').addEventListener('mousedown', function (e) {
        if (1 !== e.which) {
            return;
        }
        loop:
            for (let i = 0; i < pixelNodes.length; i++) {
                for (let ii = 0; ii < pixelNodes[i].children.length; ii++) {
                    if ('span' === pixelNodes[i].children[ii].nodeName.toLowerCase()) {
                        togglePixel(pixelNodes[i]);
                        continue loop;
                    }
                }
            }
    });
    document.getElementById('fillgrid').addEventListener('mousedown', function (e) {
        if (1 !== e.which) {
            return;
        }
        loop:
            for (let i = 0; i < pixelNodes.length; i++) {
                for (let ii = 0; ii < pixelNodes[i].children.length; ii++) {
                    if ('span' === pixelNodes[i].children[ii].nodeName.toLowerCase()) {
                        continue loop;
                    }
                }
                togglePixel(pixelNodes[i]);
            }
    });
    document.getElementById('invertgrid').addEventListener('mousedown', function (e) {
        if (1 !== e.which) {
            return;
        }
        for (let i = 0; i < pixelNodes.length; i++) {
            togglePixel(pixelNodes[i]);
        }
    });
</script>
</body>
</html>